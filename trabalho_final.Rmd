---
title: "Trabalho Final"
author: "Julia Marques, Letícia Dufloth, Pedro Paulo Polastri e Rodrigo Prates"
date: "18/07/2020"
output: github_document
---
```{r, include=FALSE}
# Espaco para instalacao e library de pacotes

library(tidyverse); library(forcats); library(magrittr); library(dplyr); 
library(kableExtra); 

# Base de dados a ser utilizada com informações de bolsistas do ProUni

df <- read.csv("data/pda-prouni-2019.csv", h = T, sep = ";", encoding = "UTF-8")

# Mudando o nome das colunas

names(df) <- c("Ano_de_Concessao_da_Bolsa", "Codigo_da_Universidade", 
               "Universidade", "Tipo_de_bolsa", "Modalidade_de_Ensino", "Curso",
               "Turno", "CPF_do_Beneficiario","Sexo", "Raca", 
               "Data_de_Nascimento", "Deficiente_Fisico", "Regiao", "UF", 
               "Municipio")

# Transformar os dados em factor permite verificar quantos niveis a variavel tem
# Fazendo isso apenas com as variaveis com muitos niveis
df$Universidade <- as.factor(df$Universidade)
df$Tipo_de_bolsa <- as.factor(df$Tipo_de_bolsa)
df$Curso <- as.factor(df$Curso)
df$Municipio <- as.factor(df$Municipio)
df$Data_de_Nascimento <- as.Date(df$Data_de_Nascimento, format = "%d/%m/%Y")
str(df)

# Calculando a idade
df$Idade <- as.numeric(difftime(c("2019-12-31"),df$Data_de_Nascimento, 
                                units = "weeks"))/52.25
df$Idade <- floor(df$Idade)

# Criando o df sem o outlier (pessoa com 11 anos)
df2 <- df[(-219394),]

# Gerando faixas etarias
summary(df$Idade)
df$Faixa_Etaria <- cut(df$Idade, c(10,15,20,25,30,35,40,45,50,55,60,65,70,100), 
                          labels = c("11 a 15", "16 a 20","21 a 25", "26 a 30",
                                     "31 a 35","36 a 40", "41 a 45", "46 a 50", 
                                     "51 a 55", "56 a 60", "61 a 65", "66 a 70", 
                                     "71+" ))

df2$Faixa_Etaria <- cut(df2$Idade, c(15,20,25,30,35,40,45,50,55,60,65,70,100), 
                          labels = c("16 a 20","21 a 25", "26 a 30",
                                     "31 a 35","36 a 40", "41 a 45", "46 a 50", 
                                     "51 a 55", "56 a 60", "61 a 65", "66 a 70",
                                     "71+" ))

# Identificando os valores NA e removendo da base
df <- na.omit(df)

df2 <- na.omit(df2)


```

### Introdução

O presente trabalho se configura como o trabalho final da disciplina de Análise e Visualização de Dados com R, do Curso Superior de Administração Pública da Escola de Governo Professor Paulo Neves de Carvalho da Fundação João Pinheiro, referente ao primeiro semestre de 2020. Neste trabalho, temos por objetivo analisar dados relativos às bolsas concedidas pelo ProUni (Programa Universidade para Todos), bem como o perfil de seus beneficiários.

O ProUni é um programa do Ministério da Educação que concede bolsas de estudo em instituições de ensino superior particulares. Para as bolsas integrais, os alunos precisam comprovar renda familiar bruta mensal per capita de até 1,5 salário mínimo. Para as bolsas parciais (50%), os estudantes têm que comprovar renda familiar bruta mensal per capita de até 3 salários mínimos. Além disso, é necessário que o aluno não tenha diploma de ensino superior, e que tenha realizado o Exame Nacional do Ensino Médio (ENEM) mais recente (BRASIL, 2020).

As questões que orientarão as análises do presente trabalho são:

- Qual o perfil demográfico dos bolsistas, no que se refere a gênero, raça, faixa etária e existência de deficiência?

- Como se dá a distribuição geográfica dos bolsistas por unidade federativa?

- Quais os 10 cursos que recebem mais bolsistas ProUni?

### Perfil dos bolsistas

```{r, include=FALSE}

# Tabelas de Frequencia para as caracteristicas individuais

# Frequencia Absoluta
freq.sex <- table(df$Sexo)
freq.raca <- table(df$Raca)
freq.fxet <- table(df$Faixa_Etaria)
freq.fxet2 <- table(df2$Faixa_Etaria)
freq.def <- table(df$Deficiente_Fisico)

# Tabelas Cruzadas
freq.sex.raca <- table(df$Sexo, df$Raca)
freq.sex.fxet <- table(df$Sexo, df$Faixa_Etaria)
freq.sex.fxet2 <- table(df2$Sexo, df2$Faixa_Etaria)

```


Os dados disponíveis na base permitem fazer análises interessantes quanto ao perfil dos beneficiários acerca do sexo, da faixa etária, da raça e da existência de deficiência física.

No que se refere à faixa etária, foi necessário criar dois tipos de gráficos. Isso porque verificou-se a existência de um outlier - constava na base de dados uma pessoa com 11 anos de idade, sendo que todos os outros beneficiários tinham 16 anos ou mais. Sendo assim, primeiramente será mostrado o gráfico com a inclusão do outlier e, posteriormente, será exibido o gráfico excluindo o outlier, para evidenciar a mudança na visualização.

Ressalta-se que, nos gráficos em que a variável faixa etária não estiver sendo analisada, o outlier será incluído, pois pressupõe-se que a única informação errada referente a essa pessoa é a idade.

```{r, echo=FALSE}

barplot(freq.fxet, main = "Número de beneficiários por faixa etária", col = "brown3", ylim = c(0, 99000))

barplot(freq.fxet2, main = "Número de beneficiários por sexo e faixa etária (sem outlier)", col = "brown3", ylim = c(0, 99000))

```

Observa-se que a maior parte dos beneficiários está na faixa etária entre 16 a 20 anos, e o número de beneficiários a cada faixa etária seguinte vai diminuindo.

Também é possível fazer visualizações a partir da combinação da variável faixa etária com a variável sexo:

```{r, echo=FALSE}

barplot(freq.sex.fxet, main = "Número de beneficiários por sexo e faixa etária", beside = TRUE, col = c("red", "green"))
legend("topright", legend = c("Feminino", "Masculino"), fill = c("red", "green"))

barplot(freq.sex.fxet2, main = "Número de beneficiários por sexo e faixa etária (sem outlier)", beside = TRUE, col = c("red", "green"))
legend("topright", legend = c("Feminino", "Masculino"), fill = c("red", "green"))

```

Nota-se, nesses gráficos, um comportamento semelhante aos gráficos anteriores, sendo que o número de mulheres por faixa etária é quase sempre maior do que o de homens. Os homens predominam apenas nas faixas etárias de 66 a 70 anos e na de 71 anos ou mais.

No que se refere à variável "sexo" analisada individualmente, observa-se a predominância de mulheres beneficiárias:

```{r, echo=FALSE}

barplot(freq.sex, main = "Número de beneficiários por sexo", col = c("red", "green"))

```

Ao relacionar as variáveis sexo e raça, observamos que as mulheres beneficiárias predominam em todas as raças, exceto quando a raça não foi informada (nesse caso, são 4 homens e 1 mulher):

```{r, echo=FALSE}

barplot(freq.sex.raca, main = "Número de beneficiários por sexo e raça", beside = TRUE, col = c("red","green"))
legend("topright", legend = c("Feminino", "Masculino"), fill = c("red","green"))

```

Sendo assim, percebe-se que a maior parte dos beneficiários é mulher parda, seguida de mulheres brancas, homens pardos e homens brancos.

Ao analisar a variável raça isoladamente, verifica-se que a raça parda é a predominante dentre os beneficiários, seguida pela raça branca, preta, amarela e indígena:

```{r, echo=FALSE}

barplot(freq.raca, main = "Número de beneficiários por raça", ylim = c(0, 99000), col = c("chartreuse4", "seagreen", "mediumvioletred", "navyblue", "dodgerblue", "turquoise2"))

```

Quanto à análise de dados referentes aos beneficiários com deficiência física, nota-se que eles são uma pequena parcela do total de beneficiários:

```{r, echo=FALSE}

barplot(freq.def, main = "Beneficiário é deficiente físico", col = c("blue", "orange"))
legend("topright", legend = c("Sim", "Não"), fill = c("blue","orange"))

```

Dessa forma, entende-se ser interessante filtrar somente os beneficiários com deficiência para fazer algumas análises combinadas com outras variáveis. No que se refere à raça, vê-se que a predominante dentre os beneficiários é a branca, seguida pela parda, preta e amarela:

```{r, echo=FALSE}

df %>% 
  filter(Deficiente_Fisico == "S") %>%
  mutate(Raca = fct_infreq(Raca)) %>% 
  ggplot()+
  geom_bar(aes(x = Raca), fill = c("seagreen", "dodgerblue", "turquoise2", "chartreuse4"))+
  labs(x = "Raça", y = "Número de beneficiários")+
  ggtitle("Beneficiários com deficiência física por raça")+
  theme_bw() +
  theme(plot.title = element_text(hjust = 0.5))+
  ggsave("figures/def_raca.pdf", width = 10, height = 8)

```

Verifica-se que a raça branca predomina dentre os beneficiários com deficiência, embora a raça predominante analisada individualmente seja a parda.

Também é possível observar, ao analisar o gráfico referente ao sexo dos beneficiários com deficiência, uma dissonância quanto à variável sexo analisada isoladamente, haja vista que o sexo masculino predomina:

```{r, echo=FALSE}

df %>% 
    filter(Deficiente_Fisico == "S") %>%
    mutate(Sexo = fct_infreq(Sexo)) %>% 
    ggplot()+
    geom_bar(aes(x = Sexo), fill = c("green", "red"))+
    labs(x = "Sexo", y = "Número de beneficiários")+
    ggtitle("Beneficiários com deficiência física por sexo")+
    theme_bw() +
    theme(plot.title = element_text(hjust = 0.5))+
  ggsave("figures/def_sexo.pdf", width = 10, height = 8)

```

### Distribuição Geográfica

Diante da disponibilidade dos dados dos municípios, UF's e regiões relativas à origem dos beneficiários das bolsas, podemos analisar a distribuição da concessão dessas ao redor do país, a partir de diferentes pontos.

Primeiramente, é possível perceber os beneficiários originários de capitais é quase insignificante comparado aos demais municípios.

```{r, echo=FALSE}

# Agrupando as bolsas por Município
mun <- df %>%
  group_by(Municipio, UF, Regiao) %>%
  summarise(Bolsas = n())

mun$UF <- as.character(mun$UF)
mun$Regiao <- as.character(mun$Regiao)

# Bolsas em capitais
mun <- mutate(mun, CAPITAL = ifelse( Municipio == 'RIO BRANCO' | Municipio == 'MACEIO' | Municipio == 'MACAPA' | Municipio == 'MANAUS' | Municipio == 'SALVADOR' | Municipio == 'FORTALEZA' | Municipio == 'BRASILIA' | Municipio == 'VITORIA' | Municipio == 'GOIANIA' |   Municipio == 'SAO LUIS' | Municipio == 'CUIABA' | Municipio == 'CAMPO GRANDE' | Municipio == 'BELO HORIZONTE' | Municipio == 'BELEM' | Municipio == 'JOAO PESSOA' | Municipio == 'CURITIBA' | Municipio == 'RECIFE' | Municipio == 'TERESINA' | Municipio == 'RIO DE JANEIRO' | Municipio == 'NATAL' | Municipio == 'PORTO ALEGRE' |Municipio == 'PORTO VELHO' | Municipio == 'CURITIBA' | Municipio == 'BOA VISTA' |  Municipio == 'FLORIANOPOLIS' | Municipio == 'SAO PAULO' | Municipio == 'ARACAJU' | Municipio == 'PALMAS', "SIM", "NAO"))

caps <- mun %>%
  group_by(CAPITAL) %>%
  summarise(Bolsas = n())

pie(caps$Bolsas, radius = 1, labels = c("Demais municípios", "Capitais"), col = c(5,2), main = 'Distribuição das bolsas entre municípios')

```

Quanto aos beneficiários por UF e Região, observa-se as seguintes distribuições:

```{r, echo=FALSE}

# Bolsas por região
reg <- mun %>%
  group_by(Regiao) %>%
  summarise(Bolsas = n())

reg %>%
  ggplot()+
  geom_col(aes(x = Regiao, y = Bolsas, fill = Regiao)) +
  labs (title = 'Total de bolsas por região')

# Bolsas por UF
ufs <- mun %>%
  group_by(UF, Regiao) %>%
  summarise(Bolsas = n())

ufs %>%
  ggplot()+
  geom_col(aes(x = UF, y = Bolsas, fill = Regiao)) +
  labs (title = 'Total de bolsas por UF')

```

É possível perceber que as regiões com maior volume de bolsas concedidas são a Nordeste e a Sudeste, respectivamente, ambas com mais de 1.500 beneficiários, ao passo que a região Sul fica em terceiro lugar com mais de 1.000 e a Centro-Oeste e a Norte ficam por último e bem distantes das demais, com 400 e 395, respectivamente.

Quanto aos estados, Minas Gerais apresenta o maior número de bolsas, com aproximadamente 800, seguido de São Paulo, com aproximadamente 600, o que explica a colocação da região Sudeste. Por outro lado, O Distrito Federal (Centro-Oeste) fica em última posição, com apenas uma bolsa, ao passo que as próximas 5 UFs com menor número correspondem a 5 das 7 UFs que compõem a região Norte, o que também explica a posição dessa região em último lugar. 

Porém, os valores absolutos das regiões e dos estados podem ser decorrentes das diferenças demográficas entre eles, de maneira que é mais pertinente a análise da distribuição relativa.

### Cursos Predominantes

Os dados analisados trazem a relação dos cursos de cada um dos bolsistas do programa. A partir disso, questionamos a possibilidade de se analisar quais eram os cursos que mais recebiam bolsistas e se essa informação poderia suscitar maiores indagações ou apresentar qualquer padrão.

Abaixo estão os 10 cursos que mais receberam bolsas:
```{r, echo=FALSE}

dados <- read.csv("data/pda-prouni-2019.csv", h = T, sep = ";", encoding = "UTF-8")
Cursos_Predominantes <- dados %>% 
  na.omit() %>%                #Retirando linhas em branco
  count(NOME_CURSO_BOLSA) %>% 
  arrange(desc(n)) %>% 
  head(n = 10) 

#Renomeando Colunas
colnames(Cursos_Predominantes) <- c("Cursos", "Bolsas Concedidas")
Cursos_Predominantes %>% 
  kable()


```

Verifica-se, portanto, que os cursos predominantes são de áreas diversas, e que não seguem um padrão ou tendência observável, o que, naturalmente, é benéfico para uma politica pública que tem o intuito de ser inclusiva.

Todavia, é importante salientar que os dados colocam limitações para análise: necessitam de padronização, uma vez que foram encontrados diversas grafias para um mesmo curso (que incluíam até mesmo as localidades dos campus onde são lecionados) e encontramos diversas linhas em branco, sem qualquer informação.

### Referências
BRASIL. Ministério da Educação. **ProUni - Programa Universidade Para Todos**. Disponível em: <http://prouniportal.mec.gov.br/>. Acesso em 18 jul. 2020.
